\documentclass[usenatbib]{mnras}
\usepackage[T1]{fontenc}
\usepackage{ae,aecompl}

\usepackage{graphicx}	% Including figure files
\usepackage{amsmath}	% Advanced maths commands
\usepackage{amssymb}	% Extra maths symbols
\usepackage{array}
\usepackage{physics}

\usepackage{multirow}
\usepackage{multicol}
\usepackage{blindtext}
\newcolumntype{?}{!{\vrule width 1pt}}
\newcommand{\Msun}{\,{\rm M}$_{\odot}$\,}
\newcommand{\Mpch}{\,{\rm Mpc}\,\ifmmode h^{-1}\else $h^{-1}$\fi}
\newcommand{\kpch}{\,{\rm kpc}\,\ifmmode h^{-1}\else $h^{-1}$\fi}
\newcommand{\kpc}{\,{\rm kpc}\,}
\newcommand{\kms}{\,{\rm km}\ s$^{-1}$\,}

%%%%%%%%%%%%%%%%%%% TITLE PAGE %%%%%%%%%%%%%%%%%%%
\title[Superclusters from velocity divergence fields]{Superclusters from velocity divergence fields}
\author[Pe\~naranda-Rivera et al.]{
\parbox[t]{\textwidth}{
    {J. D. Pe\~naranda-Rivera $^1$,} 
    {D. L. Paipa-Le\'on$^{1}$,}
    {S. D. Hern\'andez-Charpak$^{1,2}$,}\\
    {J. E. Forero-Romero $^{1}$}
}
\\\\
$^{1}$ Departamento de F\'isica, Universidad de los Andes, Cra. 1
  No. 18A-10 Edificio Ip, CP 111711, Bogot\'a, Colombia \\
$^{2}$ Center for Neuroprosthetics and Brain Mind Institute, Swiss
  Federal Institute of Technology (EPFL), CH-1015, Lausanne,
  Switzerland\\  
}

% These dates will be filled out by the publisher
\date{Accepted XXX. Received YYY; in original form ZZZ}

% Enter the current year, for the copyright statements etc.
\pubyear{2019}


% Don't change these lines
\begin{document}
\label{firstpage}
\pagerange{\pageref{firstpage}--\pageref{lastpage}}
\maketitle

%%%%%====MYMARK========
\maketitle
\begin{abstract}
Superclusters are a convenient way to partition and characterize the large scale structure of the Universe.
In this Letter we explore the strengths of defining superclusters as watershed basins in the divergence velocity field.
We apply this definition on diverse datasets generated from linear theory and  N-body simulations, with different grid sizes, smoothing scales and types of tracers.
From this framework emerges a linear scaling relation between the average supercluster size and the autocorrelation length in the divergence field, a result that holds for one order of magnitude from 10 \Mpch up to 100 \Mpch.
Our results suggest that the divergence-based definition provides a robust context to quantitatively compare results across different observational or computational frameworks. 
Through its connection with linear theory, it can also facilitate the exploration of how supercluster properties depend on cosmological parameters, 
paving the way to use superclusters as cosmological probes.
\end{abstract}

\begin{keywords}
%%PREGUNTAR
%galaxies:supercluster --- simulation:cosmological --- filter:gaussian --- methods:numerical
\end{keywords}


%=========================================================================
%		PAPER CONTENT
%=========================================================================

%*************************************************************************

\section{Introduction}
% La introduccion y el abstract es lo ultimo que se escribe.


In 2014 astronomers used a peculiar velocities map  to 
define the Laniakea supercluster of galaxies
\citep{2014Natur.513...71T}.  
Their main input was the Cosmicflows-2 catalog of distances and radial
velocities that provide them with coverage of distances up to 400 Mpc
\citep{2013AJ....146...86T}. 
By applying a Wiener reconstruction  \citep{Zaroubi_1999} they obtained the
reconstruction of the 3-dimensional velocity field. 
From this reconstructions they manually defined our local galaxy supercluster, Laniakea, as the region of inflowing peculiar velocities that include the Milky Way. 

Since then a great variety of supercluster definitions have been suggested and implemented to define superclusters. 
\cite{2015A&A...575L..14C} defined superclusters from an overdensity criterion to select regions that will collapse in the future.
Under that criterion Laniakea is not considered a supercluster given that its average density is slightly below the cosmic mean.
Later, \cite{Bagchi_2017} used percolation analysis on N-body simulations to find superclusters. 
Their algorithmic definition was based on the Friends-of-Friends algorithm.
From that framework they reported on the discovery of Saraswati, a large supercluster with a wall-like structure extending over $200$ Mpc.
\cite{Einasto_2019} defined superclusters from varying cuts in a density field. 
They interpolated the dark matter density field on a grid, smoothed it with a gaussian filter and then reported on the different supercluster properties.

More recently \cite{Dupuy_2019} used streamlines in the peculiar velocity data to define 
superclusters. 
They tracked streamlines in space to define gravitational basins of attraction/repulsion.
This algorithm allowed an automatic partition to define Laniakea's boundary without manual intervention.
The algorithm involved the application of a
fourth order Runge-Kutta method. 
In this way, obtaining structures using this method is influenced by the choice of the integration parameters. 
Two more free parameters are involved in this computation: the streamline length and the number of streamlines ending on a vortex required to define a gravitational basin.

\cite{Dupuy_2020} studied the influence of the details in
the algorithm parameters on the detected gravitational basins.
The influence of a smoothing parameter was a focus of their interest. 
They reported strong changes in the supercluster abundance as a function of the smoothing scale.
However, a more detailed inspection of these trends, together with a study of how velocity interpolation from different kinds of tracers impacts the results, was left for future work.

In this Letter we present another framework to define, study and understand superclusters. 
The supercluster definition is based on the velocity divergence field, while
the supercluster finding algorithm is based on the watershed concept.
We show in this Letter how this definition helps us to reach a quantitative understanding of how the supercluster properties depend on the smoothing scale while also providing a handle to tie superclusters properties to the underlying cosmology.

This Letter is structured as follows.
In Section \ref{sec:divergence} we present our characterization of the velocity divergence field.
Next, in Section \ref{sec:watershed}, we describe the supercluster finding algorithm.
In Section \ref{sec:fields} we describe how we generate divergence fields on a grid to test our definitions and supercluster finding algorithm.
In Section \ref{sec:results} we present our main results to finally conclude in Section \ref{sec:conclusion} with future applications of the framework presented here.



\section{autocorrelation length in the divergence field}
\label{sec:divergence}
We use the velocity divergence field, $\div \textbf{v}$, as the main quantity to study over cosmological scales.
From it we define a dimensionless divergence field, $\delta(\textbf{r})$, as follows:

\begin{equation}
    \delta (\textbf{r})\equiv -\frac{1}{H_0 f} \div \bf{v},
    \label{eq:div}
\end{equation}
where $H_0$ is the Hubble parameter and $f$ is the growth rate of structure.
This is a purely computational definition motivated by the linear theory of structure formation where the equality between the two sides of Equation (\ref{eq:div}) is expected to actually hold when $\delta(\textbf{r})$ represents the matter overdensity.

We compute the power spectrum of this scalar field and denote it as $P_{\delta}(k)$. 
From this power spectrum we calculate the autocorrelation function as
\begin{equation}
    \xi_{\delta\delta} (r) = \frac{1}{2\pi^2}\int_{0}^{\infty} k^2 P_{\delta}(k)\frac{\sin kr}{kr} dk.
\end{equation}

From the autocorrelation function we define a coherence length, $R_{\delta\delta}$, as the value of $r$ at which $\xi_{\delta\delta}(r)$ drops by a factor of ten from the value it has for $r\rightarrow0$. 
Computationally speaking, we compute the autocorrelation function in the interval $1\Mpch \leq r \leq 100 \Mpch$ and $R_{\delta\delta}$ is defined by the value at which
\begin{equation}
\xi_{\delta\delta}(R_{\delta\delta})  =\frac{1}{10} \xi_{\delta\delta}(1 \Mpch).    
\label{eq:autocorrelation}
\end{equation}

We show in the following sections how by using this definition we obtain a linear relationship between the autocorrelation length, $R_{\delta\delta}$, and the average supercluster size.


\begin{table*}
\begin{tabular}{c c c c c}\hline
Field &  $v_{max}$ & $L_b$ & $R_s$ & $N_c$\\
type & (km s$^{-1}$) & (\Mpch) & (\Mpch) & \\\hline
Gaussian & - & $720$ & \{$2$, $6$, $10$, $14$, $20$\} & $360$\\
Gaussian & - & $300$ & \{$3$, $9$, $12$, $15$, $18$\} & $100$\\
Gaussian & - & $1000$ & \{$10$, $15$, $20$, $30$, $40$\} & $100$\\
N-body & $150$ & $720$ & \{$6$, $12$, $30$, $48$, $60$\} & $120$\\
N-body & $200$ & $720$ & \{$5$, $10$, $20$, $30$, $40$\} & $144$\\
N-body & $300$ & $720$ & \{$2$, $6$, $10$, $14$, $20$\} & $360$\\\hline
\end{tabular}
\caption{Summary of the $30$ different dimensionless divergence fields used in this Letter. 
The Field type describes whether the field comes from the Abacus Simulations (N-body) or it is generated from the power spectrum (Gaussian). $v_{max}$ only applies to the N-body fields and refers to the minimum value of a halo maximum circular velocity to include it in the peculiar velocity field interpolation.
$L_b$ is the box size of the cubic volume used to compute the divergence. $R_{s}$ lists the gaussian smoothing (in the case of N-body fields) and the wavelength $1/R_s$ used to truncate the power spectrum (in the case of Gaussian fields). $N_c$ is the number of grid voxels on a side of the interpolated density field.}
\label{table:values}
\end{table*}


\begin{figure*}
    \centering
    \includegraphics[width=240pt]{power_spectrum_gauss_1000_100.pdf}
    \includegraphics[width=240pt]{corr_func_gauss_1000_100.pdf}
    \caption{Power spectrum (left) and autocorrelation function (right) for dimensionless divergence fields computed from linearly extrapolated power spectrum
    The size of the cubic box is $L_b=1000$ \Mpch and the number of voxels is $100^3$.
    Each line corresponds to a different truncation wavelength in the power spectrum of $1/R_s$.
    \label{fig:gaussian}}
\end{figure*}

\begin{figure*}
    \centering
    \includegraphics[width=240pt]{power_spectrum_nbody_720_360.pdf}
    \includegraphics[width=240pt]{corr_func_nbody_720_360.pdf} 
    \caption{Power spectrum (left) and autocorrelation function (right) for dimensionless divergence fields computed using velocity interpolation from N-body data.
    The size of the cubic box is $L_b=720$ \Mpch and the number of voxels is $360^3$.
    Only dark matter haloes with maximum circular velocity larger than $300$ \kms were included in the velocity interpolation.
    Each line corresponds to a different Gaussian smoothing with length scale $R_s$.}
    \label{fig:nbody}
\end{figure*}



\section{Watershed Superclusters}
\label{sec:watershed}

We find the superclusters using a watershed algorithm \citep{BeucherWatershed1979} on the dimensionless divergence fields.
The algorithm segments the whole volume by assigning each voxel to a unique supercluster. 

Our implementation works as follows. 
We sweep the voxels in the dimensionless divergence grid from the highest values to the lowest, i.e. from the high density regions with converging flows to the lowest density regions with divergent flows.
For the $i$-th voxel under consideration we check whether its 26 neighbors have already been assigned to a group. 
If all the neighbors are unassigned, then this $i$-th voxel starts a new group; if the majority of already assigned voxels belongs to the $n$-th group, then this voxel belongs to that group.
In case of a draw between groups, the voxel is assigned to the supercluster with the lowest $n$ value.
At the end of the sweep all voxels have been assigned to a group. 
In all our calculations we take periodical boundary conditions into account.  

Finally, each group found by the algorithm is interpreted as a supercluster 
with a volume, $V_s$, calculated by the total volume of the voxels belonging to it.
From the volume $V_s$ we compute the equivalent radius $R_{\rm eq}$, that is the radius of the sphere with the same volume, 
   $ R_{\rm eq} = \left(\frac{3}{4\pi}V_{s}\right)^{1/3}$.
We describe the supercluster population in a divergence field by the average value of the equivalent radius, $\langle R_{\rm eq}\rangle$.

Once the divergence field is provided, this algorithm  does not have free parameters based either on divergence, density or distance thresholds. 
The algorithm has a single free parameter: the number of neighbors to make the search for assigned superclusters.
In our case we use $26$, but our tests show that using lower values down to $6$ neighbors do not impact the main scaling results reported in this Letter. 
A lower number of neighbors only results in a larger tail of small superclusters composed by a handful of voxels.


\section{Divergence Fields on a Grid}
\label{sec:fields}

We use dimensionless divergence fields computed on a cubic grid. 
We generate them in two different ways.
The first corresponds to Gaussian fields with a truncated power spectrum coming from linear theory.
The second kind are fields generated by interpolation of biased tracers and smoothed with a Gaussian filter, with the tracers coming from N-body cosmological simulations.
In both cases the cosmological parameters correspond to the
$\Lambda$CDM Planck 2015 cosmology \citep{2016A&A...594A..13P} with a Hubble parameter of $H_0=67.8$ km s$^{-1}$ Mpc$^{-1}$, a matter density parameter $\Omega_m=0.308$ and a spectral index $n_s=0.968$.
We use a total of $30$ different divergence fields, summarized in Table \ref{table:values}, generated as follows.

\subsection{Gaussian fields with truncated power Spectrum}

We start by generating a density field with a power spectrum that follows no-wiggle parameterization of \cite{1998ApJ...496..605E}.
The power spectrum is extrapolated at $z=0$ using linear theory and truncated at $k_{\rm max}=1/R_s$.
This density field is generated over a cubic grid with $N_c^3$ voxels over a cube of length $L_s$ on a side.
From this Gaussian density field we compute  the overdensity and directly use it as the dimensionless divergence field.
We generate $15$ different Gaussian fields by changing the values for $L_b$, $N_c$ and $R_s$. 
Table \ref{table:values} summarizes the different values for those parameters.

\subsection{N-body fields from biased tracers with Gaussian smoothing}

We use the public Friend-of-Friends catalogs at redshift $z=0.1$
from the Abacus Project simulations to interpolate the haloes' peculiar velocity over a grid with $N_s^3$ voxels.
The simulations were performed on a cube of side length $720$\ \Mpch with
$1440^3$ particles, corresponding to a DM particle mass resolution of $\sim 1 \times 10^{10}$ \Msun.
We start by selecting haloes with maximum circular velocity larger
than $v_{max}$.
Then we assign to each voxel the value of the average velocity of the haloes in that voxel, which is equivalent to a Nearest Grid Point interpolation scheme. 
If the voxel is empty we assign a value of $0$\kms.
After this interpolation step we smooth the velocity field using a Gaussian filter of physical scale $R_s$.
We generate $15$ different N-body based divergence fields by changing the values for $v_{max}$, $N_c$ and $R_s$. 
Table \ref{table:values} summarizes the different values for those parameters.



\begin{figure}
    \centering
    \includegraphics[width=220pt]{correlation_length.pdf}
    \caption{Correlation length $R_{\delta\delta}$ as a function of the truncation scale $R_s$.
    Both for Gaussian and N-body fields the relationship between the two scales is close to linear below $R_{s}=20$ \Mpch.}
    \label{fig:correlation length}
\end{figure}

\section{Results}
\label{sec:results}

We start by illustrating the differences between the Gaussian and N-body divergence fields.
Figure \ref{fig:gaussian} shows the power spectrum and the autocorrelation function for five different Gaussian fields generated over a box with side $L_b=1000$ \Mpch and $100^3$ voxels.
The five different curves correspond to different wavelength cuts in the power spectrum  $1/R_s$, with $R_s$ in the range from 10 to 40 \Mpch.
The right panel in the Figure \ref{fig:gaussian} shows that the autocorrelation length increases with larger $R_{s}$ values.

Figure \ref{fig:nbody} shows the power spectrum and autocorrelation function for N-body fields generated 
from dark matter haloes with a maximum circular velocity larger than $300$ \kms, with their peculiar velocities interpolated over on a cubic mesh of side $L_b=720$ \hMpc and  $360^3$ voxels.
Each curve corresponds to a different scale $R_s$ for the Gaussian smoothing filter.
In this case, the overall normalization of the power spectra is smaller compared to the normalization in the Gaussian fields, as it is expected from the nature of the biased tracers.
Nevertheless, the right panel confirms that the autocorrelation length also increases for larger $R_{s}$ values.

Figure \ref{fig:correlation length} shows the relationship between the truncation/smoothing scale $R_s$ and the autocorrelation length $R_{\delta\delta}$.
We find that below $R_{s} < 20$\Mpch the two scales almost follow a linear proportionality.
Beyond that scale, the Gaussian fields continue that linearity up to $R_{\delta\delta}\approx 130$\Mpch, while the N-body fields saturates around $R_{\delta\delta}\approx 100$\Mpch.


\begin{figure}
    \centering
    \includegraphics[width=220pt]{summary_watershed.pdf}
    \caption{Average equivalent radius as a function of the autocorrelation length in their parent divergence field.
    The relationship between the two quantities is close to linear for autocorrelation lengths between $10$ \Mpch and $100$ \Mpch. \label{fig:money_plot}}
\end{figure}


 
\begin{figure}
    \centering
    \includegraphics[width=220pt]{sizes_histogram.pdf}
    \caption{Equivalent radius distributions from dimensionless divergence fields derived from a Gaussian random field and a N-body simulation.
    In both cases the average value for the equivalent radius is close to $80$\Mpch. 
    The distributions shapes are different; the Gaussian field produces a narrower, closer to Gaussian, distribution than the N-body field. }  
    \label{fig:Nclusters}
\end{figure}


Our most important result is summarized in Figure \ref{fig:money_plot}.
The plot shows that 
the average supercluster size linearly follows the the autocorrelation length as defined in Equation \ref{eq:autocorrelation}.
The linear correlations holds both for Gaussian and N-body fields over one order of magnitude from $10$\Mpch up to $100$\Mpch.
In other words, the autocorrelation formalism over the velocity divergence fields is able to estimate the typical supercluster size.
We parameterize this strong linear dependence  as 
$\langle R_{\rm{eq}}\rangle=\alpha R_{\delta\delta}$, the best fit gives $\alpha=1.38\pm0.03$ for Gaussian fields and $\alpha=0.93\pm 0.01$ for N-body fields.

This linear scaling relation with $\alpha\approx 1$ depends on the constant used in the definition in Equation \ref{eq:autocorrelation}). 
Using values larger than $1/10$ in that definition breaks the linear scaling above $R_{\delta\delta}\approx 40$\Mpch for N-body fields. 
Furthermore, the regions where the linear scaling still holds, show values of $\alpha$ smaller than unity. 
Using values smaller than $1/10$ also breaks the linearity. 
It also has the inconvenient of probing scales where the autocorrelation function might oscillate, making ambiguous the autocorrelation length definition.
    
We finalize this Section by showing how the supercluster size distribution differs in Gaussian fields compared to the N-body fields.
Figure \ref{fig:Nclusters} shows the probability density function for the equivalent radius distributions from two different divergence fields.
We pick these two distributions because they have a similar mean value $\approx80$\Mpch close to Laniakea's radius. 
However, the distribution in the N-body field is wider than it is for the Gaussian field, meaning that there are more superclusters with values well above/below the average in the non-linear divergence field than in the Gaussian field. 


What does these results have to say about Laniakea?
The horizontal stripe in Figure \ref{fig:money_plot} shows recent estimates of Laniakea's equivalent radius. 
If Laniakea is to be considered as an average supercluster, then our results predict that the autocorrelation length in the divergence fields from the Cosmicflows data should be on the order of 60 \Mpch to 85 \Mpch.
Having a measurement of the autocorrelation length on the divergence field from Cosmicflows-2, would allow to quantify to what extent it is a typical supercluster in a cosmological context.
 



\section{Conclusions}
\label{sec:conclusion}


In this Letter we presented the peculiar velocity divergence field as a central element to define and understand superclusters.
We computed its autocorrelation function to give a precise definition of the coherence scale as an autocorrelation length. 
Simultaneously, to define the superclusters we performed a watershed partition over the same velocity divergence field. 
We tested this picture using different velocity divergence fields (Gaussian fields and fields from N-body simulations) computed over different grid sizes, smoothing scales and types of dark matter halos as tracers.

We found a linear scaling relation between the average supercluster size and the autocorrelation length. 
This result holds for one order of magnitude from $10$\Mpch up to $100$\Mpch.
Comparing the full size distribution in the Gaussian and N-body divergence fields (selected to have average supercluster size similar to Laniakea) we found that the distributions are narrower and more symmetric in the Gaussian field.

The concepts we have presented here are straightforward to apply both to observational data and simulations.
For instance the velocity divergence field has already been used in CosmicFlows-2 reconstruction data to define cosmic web elements \citep{2015MNRAS.452.1052L} and could thus be used to find superclusters and compute its autocorrelation length.

Future work on superclusters using this framework includes studying scaling relations between sizes, 3D shapes, maximum divergence depth and its dark matter or galaxy populations.
Another line for future work is the cosmological exploration using superclusters.
Using this framework one could estimate (via linear theory) the dependence of supercluster properties on cosmological parameters and its redshift evolution.

Finally, the link between divergence based superclusters and graph properties \citep{2020MNRAS.tmpL.153G} computed on top of the galaxy spatial distribution provides not only a potential way to define superclusters where velocity information is not available, but also a possible approach to quantify the relationship between large scale structure topology and dynamics.


\section*{Data Availability Statement}
The N-body data used to build the interpolated divergence fields are available through \url{https://lgarrison.github.io/AbacusCosmos/}. 
The code to generate the gaussian random fields and find the superclusters is available at \url{https://github.com/astroandes/WatershedDivergenceSuperclusters}

\bibliographystyle{mnras}
\bibliography{references}



\end{document}
